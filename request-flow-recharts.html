<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Flow - Recharts Diagram</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.0/dist/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            text-align: center;
        }

        .subtitle {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 14px;
        }

        #root {
            width: 100%;
        }

        .recharts-container {
            width: 100%;
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }

        .flow-diagram {
            width: 100%;
            background: #fafafa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            padding: 20px;
        }

        .stage-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stage {
            flex: 1;
            min-width: 150px;
            padding: 15px;
            border-radius: 8px;
            background: white;
            border: 2px solid #e0e0e0;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .stage:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .stage-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
        }

        .stage-description {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .stage.frontend {
            background: linear-gradient(135deg, #667eea15 0%, #667eea05 100%);
            border-color: #667eea;
        }

        .stage.backend {
            background: linear-gradient(135deg, #764ba215 0%, #764ba205 100%);
            border-color: #764ba2;
        }

        .stage.datasource {
            background: linear-gradient(135deg, #4facfe15 0%, #4facfe05 100%);
            border-color: #4facfe;
        }

        .stage.external {
            background: linear-gradient(135deg, #00f2fe15 0%, #00f2fe05 100%);
            border-color: #00f2fe;
        }

        .arrow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #667eea;
            margin: 0 10px;
        }

        .stage-row {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            gap: 10px;
            flex-wrap: wrap;
        }

        .layer-title {
            font-weight: 700;
            font-size: 16px;
            color: #667eea;
            margin-top: 30px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .stage {
                min-width: 120px;
                padding: 12px;
                font-size: 12px;
            }

            .stage-title {
                font-size: 12px;
            }

            .stage-description {
                font-size: 10px;
            }

            .arrow-container {
                font-size: 18px;
                margin: 0 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>RAG Chatbot - Request Flow (Recharts Alternative)</h1>
        <p class="subtitle">Visual breakdown of request flow stages from user input to response display</p>
        <div class="flow-diagram" id="root"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #667eea;"></div>
                <span>Frontend</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #764ba2;"></div>
                <span>Backend</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #4facfe;"></div>
                <span>Data Sources</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #00f2fe;"></div>
                <span>External APIs</span>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const RequestFlowDiagram = () => {
            const [hoveredStage, setHoveredStage] = React.useState(null);

            const stages = [
                {
                    layer: "User Interaction",
                    category: "frontend",
                    items: [
                        { title: "User", desc: "Enters query" },
                        { title: "Browser UI", desc: "HTML/CSS interface" }
                    ]
                },
                {
                    layer: "Frontend Processing",
                    category: "frontend",
                    items: [
                        { title: "script.js", desc: "sendMessage() handler" },
                        { title: "POST /api/query", desc: "JSON payload" }
                    ]
                },
                {
                    layer: "Backend Entry",
                    category: "backend",
                    items: [
                        { title: "FastAPI", desc: "Route handler (app.py)" },
                        { title: "RAG System", desc: "Orchestrator" }
                    ]
                },
                {
                    layer: "Processing",
                    category: "backend",
                    items: [
                        { title: "Session Mgr", desc: "Load history" },
                        { title: "Search Tools", desc: "Query search" }
                    ]
                },
                {
                    layer: "Data Retrieval",
                    category: "datasource",
                    items: [
                        { title: "Vector Store", desc: "Search interface" },
                        { title: "ChromaDB", desc: "Vector embeddings" }
                    ]
                },
                {
                    layer: "AI Generation",
                    category: "external",
                    items: [
                        { title: "AI Generator", desc: "Prompt builder" },
                        { title: "Claude API", desc: "Generate response" }
                    ]
                },
                {
                    layer: "Response",
                    category: "backend",
                    items: [
                        { title: "Response JSON", desc: "Answer + Sources" },
                        { title: "HTTP Response", desc: "Send to client" }
                    ]
                },
                {
                    layer: "Frontend Display",
                    category: "frontend",
                    items: [
                        { title: "Parse JSON", desc: "Handle response" },
                        { title: "Render UI", desc: "Display answer" }
                    ]
                }
            ];

            const getBackgroundColor = (category) => {
                const colors = {
                    frontend: "linear-gradient(135deg, #667eea15 0%, #667eea05 100%)",
                    backend: "linear-gradient(135deg, #764ba215 0%, #764ba205 100%)",
                    datasource: "linear-gradient(135deg, #4facfe15 0%, #4facfe05 100%)",
                    external: "linear-gradient(135deg, #00f2fe15 0%, #00f2fe05 100%)"
                };
                return colors[category] || colors.backend;
            };

            const getBorderColor = (category) => {
                const colors = {
                    frontend: "#667eea",
                    backend: "#764ba2",
                    datasource: "#4facfe",
                    external: "#00f2fe"
                };
                return colors[category] || "#999";
            };

            return (
                <>
                    {stages.map((stage, idx) => (
                        <div key={idx}>
                            <div className="layer-title" style={{ color: getBorderColor(stage.category) }}>
                                {stage.layer}
                            </div>
                            <div className="stage-row">
                                {stage.items.map((item, itemIdx) => (
                                    <React.Fragment key={itemIdx}>
                                        <div
                                            className={`stage ${stage.category}`}
                                            style={{
                                                background: getBackgroundColor(stage.category),
                                                borderColor: getBorderColor(stage.category),
                                                borderWidth: "2px"
                                            }}
                                            onMouseEnter={() => setHoveredStage(`${idx}-${itemIdx}`)}
                                            onMouseLeave={() => setHoveredStage(null)}
                                        >
                                            <div className="stage-title">{item.title}</div>
                                            <div className="stage-description">{item.desc}</div>
                                        </div>
                                        {itemIdx < stage.items.length - 1 && (
                                            <div className="arrow-container">→</div>
                                        )}
                                    </React.Fragment>
                                ))}
                            </div>
                            {idx < stages.length - 1 && (
                                <div className="arrow-container" style={{ margin: "15px 0", fontSize: "20px", justifyContent: "center" }}>
                                    ⬇
                                </div>
                            )}
                        </div>
                    ))}
                </>
            );
        };

        ReactDOM.render(<RequestFlowDiagram />, document.getElementById('root'));
    </script>
</body>
</html>
